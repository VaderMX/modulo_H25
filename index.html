<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Módulo de Autoevaluación Docente - Primaria</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    .hidden { display: none; }
    .progress-bar { transition: width 0.1s linear; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div id="app" class="max-w-2xl w-full bg-white rounded-lg shadow-lg p-6">
    <!-- Start Screen -->
    <div id="start-screen">
      <h1 class="text-2xl font-bold text-center mb-4">Autoevaluación Docente - Primaria</h1>
      <p class="text-center mb-6">Selecciona un modo de práctica:</p>
      <div class="grid gap-4">
        <button onclick="startQuiz('Rápido')" class="bg-green-500 text-white py-3 rounded-lg text-lg hover:bg-green-600">Modo Rápido (20s)</button>
        <button onclick="startQuiz('Estándar')" class="bg-blue-500 text-white py-3 rounded-lg text-lg hover:bg-blue-600">Modo Estándar (30s)</button>
        <button onclick="startQuiz('Profesional')" class="bg-orange-500 text-white py-3 rounded-lg text-lg hover:bg-orange-600">Modo Profesional (45s)</button>
      </div>
      <button onclick="showAdminLogin()" class="mt-4 text-sm text-gray-500 hover:underline">Acceso Administrador</button>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen" class="hidden">
      <h2 id="quiz-title" class="text-xl font-semibold mb-4"></h2>
      <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full progress-bar" style="width: 0%"></div>
      </div>
      <p id="timer" class="text-right mb-4"></p>
      <p id="question-text" class="text-lg mb-4"></p>
      <div id="options" class="grid gap-2"></div>
      <p id="feedback" class="mt-4 text-sm text-gray-600 hidden"></p>
      <button id="next-btn" onclick="nextQuestion()" class="hidden mt-4 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">Siguiente</button>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="hidden">
      <h2 class="text-xl font-semibold mb-4">Resultados</h2>
      <p id="score" class="text-lg mb-4"></p>
      <button onclick="restartQuiz()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">Volver a Empezar</button>
    </div>

    <!-- Admin Login -->
    <div id="admin-login" class="hidden">
      <h2 class="text-xl font-semibold mb-4">Acceso Administrador</h2>
      <input id="admin-password" type="password" placeholder="Contraseña" class="border p-2 w-full mb-4 rounded">
      <button onclick="loginAdmin()" class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">Ingresar</button>
      <button onclick="showStartScreen()" class="mt-2 text-sm text-gray-500 hover:underline">Volver</button>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="hidden">
      <h2 class="text-xl font-semibold mb-4">Panel Administrativo</h2>
      <div class="mb-4">
        <label class="mr-2">Filtrar por nivel:</label>
        <select id="level-filter" onchange="renderQuestions()">
          <option value="all">Todos</option>
          <option value="R">Rápido</option>
          <option value="E">Estándar</option>
          <option value="P">Profesional</option>
        </select>
      </div>
      <div id="question-list" class="max-h-96 overflow-y-auto"></div>
      <button onclick="showStartScreen()" class="mt-4 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600">Volver</button>
    </div>
  </div>

  <script>
    // Simple hash function for password
    function simpleHash(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash |= 0; // Convert to 32bit integer
      }
      return hash;
    }

    // Question Bank (From JSON, normalized, with example questions for E and P)
    const questions = [
      // Existing 48 questions for level R (same as before, omitted for brevity)
      {
        id: "PHC2-R-001",
        level: "R",
        text: "¿Qué principio del Artículo 3° Constitucional establece que la educación debe ser libre de doctrinas religiosas?",
        options: ["Gratuidad", "Laicidad", "Obligatoriedad", "Universalidad"],
        correct: 1,
        feedback: "La laicidad es el principio que establece que la educación debe ser ajena a cualquier doctrina religiosa."
      },
      {
        id: "PHC2-R-002",
        level: "R",
        text: "¿Qué documento desarrolla y especifica los principios y directrices que rigen el sistema educativo nacional bajo la óptica de la NEM, en consonancia con el Artículo 3° Constitucional?",
        options: ["Código Penal", "Ley General de Educación (LGE)", "Reglamento Interno Escolar", "Ley Federal del Trabajo"],
        correct: 1,
        feedback: "La Ley General de Educación (LGE) es el cuerpo normativo que desarrolla los preceptos del Artículo 3° Constitucional y rige el sistema educativo bajo la NEM."
      },
      // ... (46 more R-level questions, omitted for brevity, same as in previous response)

      // Example questions for level E (Estándar)
      {
        id: "PHC2-E-001",
        level: "E",
        text: "¿Qué estrategia de la NEM fomenta la participación activa de los estudiantes en proyectos sociocomunitarios?",
        options: ["Enseñanza tradicional", "Aprendizaje basado en proyectos", "Evaluación sumativa", "Clase magistral"],
        correct: 1,
        feedback: "El aprendizaje basado en proyectos fomenta la participación activa de los estudiantes en la resolución de problemas reales de su comunidad."
      },
      {
        id: "PHC2-E-002",
        level: "E",
        text: "¿Qué principio de la NEM prioriza la inclusión de todos los estudiantes, independientemente de sus capacidades o contextos?",
        options: ["Equidad e Inclusión", "Pensamiento Crítico", "Contextualización", "Humanismo Radical"],
        correct: 0,
        feedback: "El principio de Equidad e Inclusión busca garantizar que todos los estudiantes, sin importar sus condiciones, tengan acceso a una educación significativa."
      },
      {
        id: "PHC2-E-003",
        level: "E",
        text: "¿Qué tipo de evaluación se enfoca en identificar las necesidades de aprendizaje al inicio de un proceso educativo?",
        options: ["Formativa", "Sumativa", "Diagnóstica", "Final"],
        correct: 2,
        feedback: "La evaluación diagnóstica se realiza al inicio para identificar las necesidades y fortalezas de los estudiantes."
      },
      {
        id: "PHC2-E-004",
        level: "E",
        text: "¿Qué eje articulador de la NEM promueve la reflexión sobre las relaciones de poder y la diversidad cultural?",
        options: ["Vida Saludable", "Interculturalidad Crítica", "Artes y Experiencias Estéticas", "Inclusión"],
        correct: 1,
        feedback: "La Interculturalidad Crítica fomenta el diálogo equitativo y el respeto a la diversidad cultural, analizando las relaciones de poder."
      },
      {
        id: "PHC2-E-005",
        level: "E",
        text: "¿Qué acción del docente refleja la mediación pedagógica en un proyecto de aula?",
        options: ["Dar respuestas directas", "Guiar al estudiante con preguntas abiertas", "Ignorar las dudas", "Asignar calificaciones"],
        correct: 1,
        feedback: "La mediación pedagógica implica guiar al estudiante con preguntas abiertas para que construya su propio conocimiento."
      },
      {
        id: "PHC2-E-006",
        level: "E",
        text: "¿Qué documento normativo establece los derechos de niñas, niños y adolescentes en el ámbito educativo?",
        options: ["Ley General de Educación", "LGDNNA", "Constitución Art. 3°", "Acuerdo 08/08/23"],
        correct: 1,
        feedback: "La LGDNNA establece los derechos de niñas, niños y adolescentes, incluyendo su participación en procesos educativos."
      },
      {
        id: "PHC2-E-007",
        level: "E",
        text: "¿Qué fase de un proyecto sociocomunitario implica la ejecución de las acciones planificadas?",
        options: ["Diagnóstico", "Planeación", "Ejecución", "Evaluación"],
        correct: 2,
        feedback: "La fase de Ejecución implica llevar a cabo las acciones planificadas para abordar la problemática identificada."
      },
      {
        id: "PHC2-E-008",
        level: "E",
        text: "¿Qué principio de la NEM busca que el aprendizaje sea relevante para el contexto del estudiante?",
        options: ["Formación Integral", "Contextualización y Pertinencia", "Pensamiento Crítico", "Inclusión"],
        correct: 1,
        feedback: "La Contextualización y Pertinencia asegura que el aprendizaje se conecte con la realidad y necesidades del estudiante."
      },
      {
        id: "PHC2-E-009",
        level: "E",
        text: "¿Qué rol juega el Consejo Escolar en la gestión de recursos escolares?",
        options: ["Imponer decisiones", "Supervisar y rendir cuentas", "Excluir a la comunidad", "Solo organizar eventos"],
        correct: 1,
        feedback: "El Consejo Escolar supervisa el uso de recursos y rinde cuentas para garantizar transparencia."
      },
      {
        id: "PHC2-E-010",
        level: "E",
        text: "¿Qué enfoque promueve que los estudiantes descubran conocimientos a través de la experimentación?",
        options: ["Conductismo", "Constructivismo", "Enseñanza Directa", "Memorización"],
        correct: 1,
        feedback: "El constructivismo promueve que los estudiantes descubran conocimientos a través de la experimentación y la interacción."
      },

      // Example questions for level P (Profesional)
      {
        id: "PHC2-P-001",
        level: "P",
        text: "¿Cómo se integra el Diseño Universal para el Aprendizaje (DUA) en la planeación didáctica?",
        options: ["Estandarizando actividades", "Diseñando materiales accesibles para todos", "Excluyendo estudiantes con necesidades especiales", "Limitando opciones de evaluación"],
        correct: 1,
        feedback: "El DUA implica diseñar materiales y actividades accesibles desde el inicio para atender la diversidad de estudiantes."
      },
      {
        id: "PHC2-P-002",
        level: "P",
        text: "¿Qué elemento de la Promoción Horizontal evalúa la calidad de la práctica docente en el aula?",
        options: ["Antigüedad", "Formación Continua", "Apreciación del Desempeño", "Reconocimiento Comunitario"],
        correct: 2,
        feedback: "La Apreciación del Desempeño evalúa la calidad de la práctica docente en el aula, considerando su impacto en el aprendizaje."
      },
      {
        id: "PHC2-P-003",
        level: "P",
        text: "¿Qué estrategia fomenta la colaboración entre docentes para mejorar la práctica educativa?",
        options: ["Competencia individual", "Comunidades Profesionales de Aprendizaje", "Evaluación sumativa", "Clases aisladas"],
        correct: 1,
        feedback: "Las Comunidades Profesionales de Aprendizaje promueven la colaboración y reflexión entre docentes para mejorar la práctica."
      },
      {
        id: "PHC2-P-004",
        level: "P",
        text: "¿Qué enfoque de Vygotsky implica ajustar el apoyo según el nivel de autonomía del estudiante?",
        options: ["Modelado", "Andamiaje", "Zona de Desarrollo Próximo", "Imitación"],
        correct: 1,
        feedback: "El andamiaje es el apoyo temporal que se ajusta según el nivel de autonomía del estudiante, según Vygotsky."
      },
      {
        id: "PHC2-P-005",
        level: "P",
        text: "¿Qué documento guía el codiseño curricular en la NEM?",
        options: ["Ley General de Educación", "Acuerdo 08/08/23", "LGDNNA", "Constitución Art. 3°"],
        correct: 1,
        feedback: "El Acuerdo 08/08/23 establece las bases para el codiseño curricular en la NEM, promoviendo aprendizajes situados."
      },
      {
        id: "PHC2-P-006",
        level: "P",
        text: "¿Qué principio de la NEM fomenta el análisis crítico de problemas reales?",
        options: ["Humanismo Radical", "Pensamiento Crítico como Eje", "Inclusión", "Contextualización"],
        correct: 1,
        feedback: "El Pensamiento Crítico como Eje fomenta que los estudiantes analicen y propongan soluciones a problemas reales."
      },
      {
        id: "PHC2-P-007",
        level: "P",
        text: "¿Qué acción refleja la corresponsabilidad educativa en el Consejo Escolar?",
        options: ["Excluir a los padres", "Involucrar a la comunidad en decisiones", "Centralizar decisiones en el director", "Ignorar las necesidades locales"],
        correct: 1,
        feedback: "La corresponsabilidad educativa implica involucrar a la comunidad en las decisiones que afectan a la escuela."
      },
      {
        id: "PHC2-P-008",
        level: "P",
        text: "¿Qué tipo de retroalimentación es más efectiva en la evaluación formativa?",
        options: ["General y vaga", "Descriptiva y específica", "Punitiva", "Numérica"],
        correct: 1,
        feedback: "La retroalimentación descriptiva y específica ayuda a los estudiantes a ajustar sus estrategias de aprendizaje."
      },
      {
        id: "PHC2-P-009",
        level: "P",
        text: "¿Qué campo formativo aborda la relación entre el individuo y su comunidad?",
        options: ["Lenguajes", "Saberes y Pensamiento Científico", "De lo Humano y lo Comunitario", "Ética, Naturaleza y Sociedades"],
        correct: 2,
        feedback: "El campo De lo Humano y lo Comunitario se centra en la identidad y el bienestar en relación con la comunidad."
      },
      {
        id: "PHC2-P-010",
        level: "P",
        text: "¿Qué estrategia preventiva contra el acoso escolar implica círculos de diálogo?",
        options: ["Cultura de Paz Permanente", "Protocolos Activos", "Talleres con Familias", "Ignorar el problema"],
        correct: 1,
        feedback: "Los círculos de diálogo son parte de la estrategia de Cultura de Paz Permanente para prevenir el acoso escolar."
      }
    ];

    let currentMode = '';
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let timerInterval;
    let timeLeft = 0;

    function startQuiz(mode) {
      console.log(`Iniciando modo: ${mode}`); // Debugging
      currentMode = mode;
      const levelMap = { 'Rápido': 'R', 'Estándar': 'E', 'Profesional': 'P' };
      currentQuestions = questions.filter(q => q.level === levelMap[mode]).sort(() => Math.random() - 0.5).slice(0, 10);
      console.log(`Preguntas encontradas: ${currentQuestions.length}`); // Debugging
      if (currentQuestions.length === 0) {
        alert(`No hay preguntas disponibles para el modo ${mode}. Por favor, agrega preguntas para el nivel ${levelMap[mode]}.`);
        return;
      }
      currentQuestionIndex = 0;
      score = 0;
      showQuizScreen();
      loadQuestion();
    }

    function showQuizScreen() {
      console.log('Mostrando pantalla de cuestionario'); // Debugging
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('quiz-screen').classList.remove('hidden');
      document.getElementById('quiz-title').textContent = `Modo ${currentMode}`;
    }

    function loadQuestion() {
      const question = currentQuestions[currentQuestionIndex];
      console.log(`Cargando pregunta: ${question.id}`); // Debugging
      document.getElementById('question-text').textContent = question.text;
      document.getElementById('options').innerHTML = '';
      question.options.forEach((option, i) => {
        const btn = document.createElement('button');
        btn.className = 'bg-gray-200 p-3 rounded-lg text-left hover:bg-gray-300';
        btn.textContent = option;
        btn.onclick = () => selectOption(i);
        document.getElementById('options').appendChild(btn);
      });
      document.getElementById('feedback').classList.add('hidden');
      document.getElementById('next-btn').classList.add('hidden');
      updateProgressBar();
      startTimer();
    }

    function startTimer() {
      const times = { 'Rápido': 20, 'Estándar': 30, 'Profesional': 45 };
      timeLeft = times[currentMode];
      document.getElementById('timer').textContent = `Tiempo: ${timeLeft}s`;
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = `Tiempo: ${timeLeft}s`;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          selectOption(-1); // Time out
        }
      }, 1000);
    }

    function selectOption(index) {
      clearInterval(timerInterval);
      const question = currentQuestions[currentQuestionIndex];
      const feedbackEl = document.getElementById('feedback');
      feedbackEl.classList.remove('hidden');
      if (index === -1) {
        feedbackEl.textContent = '¡Tiempo agotado! ' + question.feedback;
      } else if (index === question.correct) {
        score++;
        feedbackEl.textContent = '¡Correcto! ' + question.feedback;
        feedbackEl.classList.add('text-green-600');
      } else {
        feedbackEl.textContent = 'Incorrecto. ' + question.feedback;
        feedbackEl.classList.add('text-red-600');
      }
      document.getElementById('next-btn').classList.remove('hidden');
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < currentQuestions.length) {
        loadQuestion();
      } else {
        showResults();
      }
    }

    function updateProgressBar() {
      const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
      document.getElementById('progress-bar').style.width = `${progress}%`;
    }

    function showResults() {
      document.getElementById('quiz-screen').classList.add('hidden');
      document.getElementById('results-screen').classList.remove('hidden');
      document.getElementById('score').textContent = `Puntaje: ${score} de ${currentQuestions.length}`;
    }

    function restartQuiz() {
      document.getElementById('results-screen').classList.add('hidden');
      document.getElementById('start-screen').classList.remove('hidden');
    }

    function showAdminLogin() {
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('admin-login').classList.remove('hidden');
    }

    function loginAdmin() {
      const password = document.getElementById('admin-password').value;
      if (simpleHash(password) === simpleHash('Vader2025')) {
        document.getElementById('admin-login').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        renderQuestions();
      } else {
        alert('Contraseña incorrecta');
      }
    }

    function showStartScreen() {
      document.getElementById('admin-login').classList.add('hidden');
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('quiz-screen').classList.add('hidden');
      document.getElementById('results-screen').classList.add('hidden');
      document.getElementById('start-screen').classList.remove('hidden');
    }

    function renderQuestions() {
      const filter = document.getElementById('level-filter').value;
      const filteredQuestions = filter === 'all' ? questions : questions.filter(q => q.level === filter);
      const list = document.getElementById('question-list');
      list.innerHTML = '';
      filteredQuestions.forEach(q => {
        const div = document.createElement('div');
        div.className = 'border p-4 mb-2 rounded';
        div.innerHTML = `
          <p><strong>ID:</strong> ${q.id} | <strong>Nivel:</strong> ${q.level}</p>
          <p><strong>Pregunta:</strong> <input type="text" value="${q.text}" class="border p-1 w-full" onchange="updateQuestion('${q.id}', 'text', this.value)"></p>
          ${q.options.map((opt, i) => `
            <p><strong>Opción ${i + 1}:</strong> <input type="text" value="${opt}" class="border p-1 w-full" onchange="updateQuestion('${q.id}', 'options[${i}]', this.value)"> 
            <input type="radio" name="correct-${q.id}" ${i === q.correct ? 'checked' : ''} onchange="updateQuestion('${q.id}', 'correct', ${i})"> Correcta</p>
          `).join('')}
          <p><strong>Retroalimentación:</strong> <input type="text" value="${q.feedback}" class="border p-1 w-full" onchange="updateQuestion('${q.id}', 'feedback', this.value)"></p>
        `;
        list.appendChild(div);
      });
    }

    function updateQuestion(id, field, value) {
      const question = questions.find(q => q.id === id);
      if (field.startsWith('options[')) {
        const index = parseInt(field.match(/\d+/)[0]);
        question.options[index] = value;
      } else if (field === 'correct') {
        question.correct = value;
      } else {
        question[field] = value;
      }
    }
  </script>
</body>
</html>